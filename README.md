rocksdb
=======

Storage layer to access rippled nodestore and a tool for dumping its contents by walking the ledger from a  specified start and end ledger hash.


##Installation

Install [Go](http://golang.org/doc/install) making sure to set a GOPATH and add GOPATH/bin to your PATH.
Install [RocksDB dependencies](https://github.com/facebook/rocksdb/blob/master/INSTALL.md).

```bash
git clone https://github.com/facebook/rocksdb.git
cd rocksdb
make shared_lib
CGO_CFLAGS="-I/path/to/rocksdb/include" CGO_LDFLAGS="-L/path/to/rocksdb" go get -u -v github.com/rubblelabs/rocksdb/rdb
```

changing the /path/to/rocksdb as appropriate.


##Usage

For OSX

```bash
export DYLD_LIBRARY_PATH=/path/to/rocksdb/
rdb -help
```

For Linux

```bash
export LD_LIBRARY_PATH=/path/to/rocksdb/
rdb -help
```

##Examples

All commands have a -start and -end flag which is a ledger hash. For example to get a summary of ledgers 100,000 to 32570 (the default), you can do:

```bash
rdb -start="491E88B0A5AB29378B4F4E6EAB1E782AF495D712A817C943D0D7A36045EFA611" -end="4109C6F2045FC7EFF4CDE8F9905D19C28820D8630408F886B299F0206E42B5" -path=nodedb/ -command=summary
100000,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99999,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99998,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99997,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
...
```

Show the summary of all transactions and account state nodes in a ledger, with columns:

Ledger Sequence, Transaction Inner Nodes, Payments, AccountSets, SetRegularKeys, OfferCreates, OfferCancels, TrustSets, Amendments, SetFees, Account Inner Nodes, AccountRoot, DirectoryNode, Amendments, LedgerHashes, Offer, RippleState, FeeSettings

```bash
rdb -path=nodedb/ -command=summary
100000,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99999,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99998,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99997,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99996,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99995,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
99994,0,0,0,0,0,0,0,0,0,337,213,140,0,3,30,115,0
....
```

Show the diff between one ledger's account state and its predecessor's account state, with columns:

Ledger, Deleted/Added, Node Type, Depth, NodeId

```bash
rdb -path=nodedb/ -command=diff 
100000,D,Account Node,0,87696621BDF55B732FC417BFA3FC36D71A14A9A7DB46A8B39A2A065F58666639
100000,A,Account Node,0,1082031456E3CE683C94368E067CF44D22B4456A793235163B333E69F4E716EA
100000,D,Account Node,1,1FF75ADD40F93FD4D77CC009AAE7A275FC1E75015269315989C5D72B829252EA
100000,A,Account Node,1,9FD199A4A5187EB1DE2E2BDFC6D6C6540C1E711B38C3BAF06F0899D0BAE68A39
100000,D,Account Node,2,028D4882965C99E04CE30B874A814048FFA875FD99865F2E809B0DA62EB63590
100000,A,Account Node,2,B23E62382281E1C6D601FD201E301B5898CDA7AFAF247FF833FA82D318068CD1
100000,D,LedgerHashes,3,37460D2E11F66522F3581884EAF8E7F8C362711DF8E42B5484203A045008F2BC
100000,A,LedgerHashes,3,DC4B6FD5BCA04FC4CAF0E54E8BDA547C470F742F5646A64E50C49A5B391FD231
99999,D,Account Node,0,1E987534476DD69123E3779C21E2E93CD6AC5938B58B88572F7227E61400BB87
99999,A,Account Node,0,87696621BDF55B732FC417BFA3FC36D71A14A9A7DB46A8B39A2A065F58666639
...
```

Dump the ledger headers:

```bash
rdb -path=nodedb/ -command=ledgers 
491E88B0A5AB29378B4F4E6EAB1E782AF495D712A817C943D0D7A36045EFA611:000186A0000186A0014C575200000186A0016345785D89D9044570B5228629561CAA77851EFA880D355C6559150C97F5BB619A549DA579CF1D00000000000000000000000000000000000000000000000000000000000000001082031456E3CE683C94368E067CF44D22B4456A793235163B333E69F4E716EA188A1728188A173C0A00
4570B5228629561CAA77851EFA880D355C6559150C97F5BB619A549DA579CF1D:0001869F0001869F014C5752000001869F016345785D89D904D711E24F58292814F1782E1B978010E3035EB15A0E6C2C21D3C81A6D06DC49A1000000000000000000000000000000000000000000000000000000000000000087696621BDF55B732FC417BFA3FC36D71A14A9A7DB46A8B39A2A065F58666639188A1714188A17280A00
D711E24F58292814F1782E1B978010E3035EB15A0E6C2C21D3C81A6D06DC49A1:0001869E0001869E014C5752000001869E016345785D89D9042ACFD78893111663AE5FFBEA683FED073A15935F887E9A1E3001B907B1299E3F00000000000000000000000000000000000000000000000000000000000000001E987534476DD69123E3779C21E2E93CD6AC5938B58B88572F7227E61400BB87188A1700188A17140A00
2ACFD78893111663AE5FFBEA683FED073A15935F887E9A1E3001B907B1299E3F:0001869D0001869D014C5752000001869D016345785D89D904DB714BD4503A4096AB7BFAB5174D8D30D4FB5CF05476CF4D8F9E8077226A18B7000000000000000000000000000000000000000000000000000000000000000088CBCDA8D06B275494BD812C3DD8FB414F81300D97FB5943DE2738DA7215B413188A16EC188A17000A00
...
```

Dump the whole account state tree with columns:

Ledger, Depth, Node Type, Hash

```bash
rdb -path=nodedb/ -command=dump
100000,0,Account Node,1082031456E3CE683C94368E067CF44D22B4456A793235163B333E69F4E716EA
100000,1,Account Node,044B598464FCB5610BAA175D7D509330056ED7728B59D562BF8DABDBB0954B99
100000,2,AccountRoot,C33503A9095C6C96705873B1718BBBB58C9BAC0896CFB5AD82C7BCB4C4B46C3B
100000,2,RippleState,516E55AE9D90AACE555194EBDF218D9D160BFB452CB0316C67E61C5EB5894558
100000,2,Account Node,3AA513307C765D790BE322300A9C76D849977E718A9DD0359F85B598CD6A14C8
...
```

Dump the transactions:

```bash
rdb -path=nodedb/ -command=transactions
56D79CE2BF58F38BB780D64104DEBCCDBD1A1F9786366E6BC26C89A3F826BC1D:000186940001869404534E4400991200032200010000240000003568400000000000000A732102E49205C3DB670A6303AEDE2CACCA4EA4E2C5C38BDB93A5CF7AB17EE7ECC4AAEA74483046022100C8D5D26FDD10DE6F2BBC9B19A67F626134C77A3BF0E8AA92D864EA93BC701667022100A1DC34D6223D5DA46809E464057B1B3129C43DB21E224D06296F269E82A9357E81141B7DAD306A3F274EC898DA985ED9C70B174BDD3997201C00000000F8E51100612500018692553D29D1F990164331FF07647D35D5E116C98FDF948A5604EE097858B22AC337F8560A74A12B225256174DEA8A0725A9990EAE24A9C693DC6BB9572C567E4A695F25E6240000003562400000020BC0D930E1E7220002000024000000362D0000000162400000020BC0D92681141B7DAD306A3F274EC898DA985ED9C70B174BDD39E1E1F1031000A3D2E0B06D57D1521F35CA623FCCAE09BF510185732BDBC306839AA6B25C417F
F9D655AA8722F157B0C6A37E73E96FC05C16FB461C6E136DE8D77980EF5898B7:000186920001869204534E4400B81200002200000000240000003461400000001DCD650068400000000000000A732102E49205C3DB670A6303AEDE2CACCA4EA4E2C5C38BDB93A5CF7AB17EE7ECC4AAEA74483046022100D1A72F916DB5894C199AE478EB642C754A91DDEC7060E6BEAB1E833C5212D442022100DEFAC81FF3F80513CB78F4FC185B468A46884B0181F4BE6E79DB446EA3D3F40781141B7DAD306A3F274EC898DA985ED9C70B174BDD398314C187B1520AEC03B66FD7F1F19D25BF1297C7F4CEC122201C00000000F8E5110061250001868A55831A1EECC9FC06F8B74FB3FA58CBB3CA1A167BAA282D35076B7499954D163E6A560A74A12B225256174DEA8A0725A9990EAE24A9C693DC6BB9572C567E4A695F25E624000000346240000002298E3E3AE1E7220002000024000000352D0000000162400000020BC0D93081141B7DAD306A3F274EC898DA985ED9C70B174BDD39E1E1E311006156D4232D196E9B8DB249D40F1C213CAA72801A5D06D8DDFB1358733AB04DBB5627E8240000000162400000001DCD65008114C187B1520AEC03B66FD7F1F19D25BF1297C7F4CEE1E1F10310003D29D1F990164331FF07647D35D5E116C98FDF948A5604EE097858B22AC337F8
683F23341A3CDE836CB5006D898474A7317D541419E0E6BABE383F8380875961:000186900001869004534E4400B712000022000000002400000027614000000005F5E10068400000000000000A732102CE86AFCD4AB0A4CD25DAF376285ABA3A9CF564C08E69B768E2615B09B886D82B74473045022100E7E5122BD8A0CFC07BFAF86ED98E2FF2D2548AD3DF78AFE25524B9ECFA888955022010963F9FC7E07AF698255E23033B61E2A1DF2DE910A4A1DE0760F0C8621D3B7181145B1CFDD87C0A87B3B1FC0D0D590A787D30765CC18314C187B1520AEC03B66FD7F1F19D25BF1297C7F4CE97201C00000000F8E5110061250001862455EE6B31FA61B24E70812DC9AC76033AF6E13A9A6DEE8A6085FB74D5B35BE690FC56DA8DFF15BA485D874123375FF4E201D20A7D9219A85148B897A4C3D6C63D4C3EE624000000276240000000123B4E8CE1E7220000000024000000282D000000026240000000123B4E8281145B1CFDD87C0A87B3B1FC0D0D590A787D30765CC1E1E1F103107D75F700EF598460E92C48C5B75452162ECB8C60613E94EE80C4FE29CE3BA1E403
...
```

Dump the account states (leaf nodes only):

```bash
rdb -path=nodedb/ -command=accounts 
C33503A9095C6C96705873B1718BBBB58C9BAC0896CFB5AD82C7BCB4C4B46C3B:0000000000000000034D4C4E001100612200000000240000000A2500017D0A2B3BE715402D00000000413A3C36EEB25EDD249CE94474035CB006551913D115FF45B60E6D0A9A241994D8A3F4A6426B303F0DDAE5A0CDA758C849D262400000003E2AEA66770D776565786368616E67652E636F81147469B8AA28E3EB31ECFFE48C1E66D1BB185DB789006E0B1413DC1D5A8076190562F32B015894CA550AC8A335115F2BF8C453759F
516E55AE9D90AACE555194EBDF218D9D160BFB452CB0316C67E61C5EB5894558:0000000000000000034D4C4E0011007222000300002500011B3D37000000000000000038000000000000000055921FAE2F6F95DC354122EEFFB86BF894A947BC0E8FCB3B21CB705762B7A5CB7962D4871AFD498D00000000000000000000000000005553440000000000000000000000000000000000000000000000000166D4C38D7EA4C68000000000000000000000000000555344000000000012DC0654E3190F66CC994EF9E214503305B979AD67D4871AFD498D0000000000000000000000000000555344000000000054EE3CE2AC4E9F5524BBCCE0C77F7DEF1CFC46C9017AF787B464E572EE0CEA0777D0D7CE494BC83AEF1F9E97301BF686DFD0B213
73D2969770667D2446BC4FA989074087783941E993FD90C0CF7FE56C8A4D2F46:0000000000000000034D4C4E0011007222000200002500016D5137000000000000000038000000000000000055BB17B917AA0BB76EAA9CE4B4C54AFAB1DB5BC5B2204F0CC13F592D25422B30396280000000000000000000000000000000000000004C5443000000000000000000000000000000000000000000000000016680000000000000000000000000000000000000004C5443000000000019820818AA13DF56AB2B4195F9131520CA80461267D5438D7EA4C680000000000000000000000000004C54430000000000F9D8D8EB960BFE54E0DA94854C5DF887995EC485023EA56AC490102DE36C702C3194AE15CBA669399FC113C551851FB15CCA51DC
...
```


